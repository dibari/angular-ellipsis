angular.module("dibari.angular-ellipsis",[]).directive("ellipsis",["$timeout","$window","$sce",function(a,b,c){var d=function(b){var c=null,d=[];this.remove=function(b){d.indexOf(b)!==-1&&(d.splice(d.indexOf(b),1),0===d.length&&(a.cancel(c),c=null))},this.add=function(e){d.indexOf(e)===-1&&d.push(e),c||(c=a(function(){var a=d.slice();c=null,d.length=0,a.forEach(function(a){a()})},b))}},e=new d(0),f=new d(75);return{restrict:"A",scope:{ngShow:"=",ngBind:"=",ngBindHtml:"=",ellipsisAppend:"@",ellipsisAppendClick:"&",ellipsisSymbol:"@",ellipsisSeparator:"@",useParent:"@",ellipsisSeparatorReg:"=",ellipsisFallbackFontSize:"@"},compile:function(a,d,g){return function(a,d,g){function h(a){return"undefined"!=typeof a}function i(a){var b=0;return angular.forEach(a.parent().children(),function(c){c!=a[0]&&(b+=c.clientHeight)}),a.parent()[0].clientHeight-b}function j(){var b=a.ngBind||a.ngBindHtml,e=!1;if(c.isEnabled()&&angular.isObject(b)&&c.getTrustedHtml(b)&&(e=!0,b=c.getTrustedHtml(b)),b){var f=!a.ngBind&&!!a.ngBindHtml,l="undefined"!=typeof g.ellipsisSymbol?g.ellipsisSymbol:"&hellip;",n="undefined"!=typeof a.ellipsisSeparator?g.ellipsisSeparator:" ",o="undefined"!=typeof a.ellipsisSeparatorReg&&a.ellipsisSeparatorReg,p="undefined"!=typeof a.ellipsisAppend&&""!==a.ellipsisAppend?l+"<span class='angular-ellipsis-append'>"+a.ellipsisAppend+"</span>":l,q=o?b.match(o):b.split(n);if(g.isTruncated=!1,f?d.html(b):d.text(b),h(g.ellipsisFallbackFontSize)&&k(d)&&d.css("font-size",g.ellipsisFallbackFontSize),k(d,a.useParent)){var s=(q.length,a.useParent?i(d):d[0].clientHeight);f?d.html(b+p):d.text(b).html(d.html()+p),d.attr("data-overflowed","true");const t=m(d,q,n,p,f,a,s);f?d.html(q.slice(0,t).join(n)+p):d.text(q.slice(0,t).join(n)).html(d.html()+p),g.isTruncated=!0,l!=p&&"undefined"!=typeof a.ellipsisAppendClick&&""!==a.ellipsisAppendClick&&d.find("span.angular-ellipsis-append").bind("click",function(b){a.$apply(function(){a.ellipsisAppendClick.call(a,{event:b})})}),!e&&c.isEnabled()&&c.trustAsHtml(b)}else d.attr("data-overflowed","false")}}function k(a,b){return a=b?a.parent():a,a[0].scrollHeight>a[0].clientHeight}function l(a,b,c,d,e,f,g,h){return f?b.html(c.slice(0,a).join(d)+e):b.text(c.slice(0,a).join(d)).html(b.html()+e),(g.useParent?b.parent()[0]:b[0]).scrollHeight<h||k(b,g.useParent)===!1}function m(a,b,c,d,e,f,g){var h=b.length,i=0;if(l(h,a,b,c,d,e,f,g))i=h;else for(;;)if(currentGuess=Math.floor((h+i)/2),l(currentGuess,a,b,c,d,e,f,g)?i=currentGuess:h=currentGuess,h-i<=1)break;return i}function n(){g.lastWindowResizeWidth==window.innerWidth&&g.lastWindowResizeHeight==window.innerHeight||j(),g.lastWindowResizeWidth=window.innerWidth,g.lastWindowResizeHeight=window.innerHeight}function p(){f.add(n)}g.lastWindowResizeTime=0,g.lastWindowResizeWidth=0,g.lastWindowResizeHeight=0,g.lastWindowTimeoutEvent=null,g.isTruncated=!1,a.$watch("ngShow",function(){e.add(j)}),a.$watch("ngBind",function(){e.add(j)}),a.$watch("ngBindHtml",function(){e.add(j)}),a.$watch("ellipsisAppend",function(){j()}),a.$watch(function(){return 0!=d[0].offsetWidth&&0!=d[0].offsetHeight},function(){f.add(j)});var o=a.$on("dibari:refresh-ellipsis",function(){e.add(j)}),q=angular.element(b);q.bind("resize",p),a.$on("$destroy",function(){q.unbind("resize",p),e.remove(j),f.remove(n),o&&(o(),o=null)})}}}}]);